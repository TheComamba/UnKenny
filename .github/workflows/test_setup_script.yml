name: Test setup.sh

on:
    pull_request:
        branches: [ main ]
    push:

jobs:
    testSetupScript:
        strategy:
            fail-fast: false
            matrix:
                container: ['ubuntu:22.04', 'ubuntu:24.04', 'debian:bullseye', 'debian:bookworm']
                include:
                    - container: 'ubuntu:22.04'
                      os: ubuntu-latest
                    - container: 'ubuntu:24.04'
                      os: ubuntu-latest
                    - container: 'debian:bullseye'
                      os: debian-latest
                    - container: 'debian:bookworm'
                      os: debian-latest
        runs-on: ${{ matrix.os }}
        container: ${{ matrix.container }}

        steps:
        - name: Checkout code
          uses: actions/checkout@v2

        - name: Check that npm is not installed before setup
          run: |
                if command -v npm > /dev/null; then
                    echo "npm is already installed"
                    exit 1
                fi

        - name: Run setup.sh
          run: |
                chmod +x ./setup.sh
                ./setup.sh

        - name: Check npm installation
          run: |
                command -v npm
